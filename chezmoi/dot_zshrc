[ -f ~/.zsh_local ] && source ~/.zsh_local # local configs, private envs

# lang
export LANG="en_US.UTF-8"
export LC_ALL="en_US.UTF-8"

# antigen setup
source ~/antigen.zsh
antigen use oh-my-zsh
antigen bundle git
antigen bundle zsh-users/zsh-completions
antigen bundle Aloxaf/fzf-tab
antigen apply


# Aliases
alias o="open"
alias dl="aria2c"
alias ac="claude --dangerously-skip-permissions"

# HISTORY
setopt EXTENDED_HISTORY   # enable more detailed history (time, command, etc.)
setopt SHARE_HISTORY      # share history across multiple zsh sessions
setopt APPEND_HISTORY     # append to history
setopt INC_APPEND_HISTORY # adds commands as they are typed, not at shell exit
setopt HIST_VERIFY        # let you edit !$, !! and !* before executing the command
setopt HIST_IGNORE_DUPS   # do not store duplications
setopt HIST_REDUCE_BLANKS # removes blank lines from history
setopt HIST_IGNORE_SPACE  # command without history when prefix with Space
HISTSIZE=10000000
SAVEHIST=$HISTSIZE

# Editor
export EDITOR="nvim"

# homebrew
export HOMEBREW_NO_ANALYTICS=1
export HOMEBREW_NO_AUTO_UPDATE=1
export HOMEBREW_VERBOSE=1

if [[ -f /opt/homebrew/bin/brew ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
  FPATH=/opt/homebrew/share/zsh/site-functions:$FPATH
fi

autoload -Uz compinit
if [[ -n ~/.zcompdump(#qN.mh+24) ]]; then
  compinit
else
  compinit -C
fi

# PATH
export PATH=~/.bin:$PATH

# Nvim
(( $+commands[nvim] )) && alias vi="nvim" v="nvim" vim="nvim"

# lazygit
alias lg="lazygit"

# fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
export FZF_DEFAULT_COMMAND='rg --files --hidden --no-ignore --follow'
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_DEFAULT_OPTS="--tiebreak end"

# starship (cached init)
if (( $+commands[starship] )); then
  _starship_cache="${XDG_CACHE_HOME:-$HOME/.cache}/starship_init.zsh"
  if [[ ! -f "$_starship_cache" || "$_starship_cache" -ot "$(command -v starship)" ]]; then
    starship init zsh > "$_starship_cache"
  fi
  source "$_starship_cache"
  unset _starship_cache
fi

# gj
export GJ_ROOT=~/Developer/code

# restic
export RESTIC_REPOSITORY="rest:http://restic:restic@vault.local:8769"
export RESTIC_PASSWORD_COMMAND="op read 'op://Personal/vault/restic encryption'"

# ripgrep
export RIPGREP_CONFIG_PATH="$HOME/.ripgreprc"

(( $+commands[bat] )) && alias cat="bat"

# eza alias
if (( $+commands[eza] )); then
  alias ls='eza'
  alias l='eza --icons -lbF'
  alias lt='eza --icons --tree --level=2'
fi

# fzf-tab
# disable sort when completing `git checkout`
zstyle ':completion:*:git-checkout:*' sort false

# yazi
function y() {
  local tmp="$(mktemp -t "yazi-cwd.XXXXXX")"
  yazi "$@" --cwd-file="$tmp"
  if cwd="$(cat -- "$tmp")" && [ -n "$cwd" ] && [ "$cwd" != "$PWD" ]; then
    cd -- "$cwd"
  fi
  rm -f -- "$tmp"
}

# zoxide (cached init)
if (( $+commands[zoxide] )); then
  _zoxide_cache="${XDG_CACHE_HOME:-$HOME/.cache}/zoxide_init.zsh"
  if [[ ! -f "$_zoxide_cache" || "$_zoxide_cache" -ot "$(command -v zoxide)" ]]; then
    zoxide init zsh > "$_zoxide_cache"
  fi
  source "$_zoxide_cache"
  unset _zoxide_cache
fi

(( $+commands[aicommits] )) && alias aic='aicommits'

# TLDR update
export TLDR_AUTO_UPDATE_DISABLED=1
